{% extends "admin/base.html.twig" %}

{% block title %}Lise des Propositions{% endblock %}
{% block stylesheets %}<link rel="stylesheet" href="{{ asset('css/propositionsAdmin.css') }}">{% endblock %}

{% block body %}
    <div class="box">
        <div class="box-body">
            <table id="propositionsTable" class="table table-bordered">
                <thead>
                <tr>
                    <th>Statut</th>
                    <th>Titre</th>
                    <th>Entreprise</th>
                    <th>Classe(s)</th>
                    <th>Technologie(s)</th>
                    <th>Commentaire</th>
                    <th>Postée le</th>
                    <th>Etudiant affecté</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                {% for uneProposition in propositions  %}
                    <tr>
                        <td align="center">{{ uneProposition.codeEtat.nomEtat }}<br/><br/>
                            {% if (uneProposition.codeEtat.codeEtat == 1) %}<div id="cercleAttente"></div>{% endif %}
                            {% if (uneProposition.codeEtat.codeEtat == 2) %}<div id="cercleValid"></div>{% endif %}

                            {% if (uneProposition.codeEtat.codeEtat == 4) %}<div id="cercleArchive"></div>{% endif %}
                            {% if (uneProposition.codeEtat.codeEtat == 5) %}<div id="cercleRefuse"></div>{% endif %}
                        </td>
                        <td><a href="{{ path("afficherPropositionbyid", {'id': uneProposition.codeProposition}) }}">{{ uneProposition.titreproposition }}</a></td>
                        <td>{{ uneProposition.codeentreprise.nomentreprise }}</td>
                        <td>
                            {% for classe in uneProposition.codeclasse %}
                                {{ classe.nomclasse }}<br/>
                            {% endfor %}
                        </td>
                        <td>
                            {% for techno in uneProposition.codetechnologie %}
                                {{ techno.nomtechnologie }}<br/>
                            {% endfor %}
                        </td>
                        <td>{{ uneProposition.commentaire }}</td>
                        <td>{{ uneProposition.dateajout|date("d/m/Y H:i") }}</td>
                        <td>{% if (uneProposition.codeEtudiant is not null) %} {{ uneProposition.codeEtudiant.prenomEtudiant }} {{ uneProposition.codeEtudiant.nomEtudiant }} {% else %} Non affecté {% endif %}</td>
                        <td>
                            <a href="{{ path('editPropositionAdmin', {'id': uneProposition.codeproposition}) }}" class="btn btn-primary"><i class="fa fa-edit" aria-hidden="true"></i> Editer</a><br/>
                            {% if (uneProposition.codeEtat.codeEtat == 2 and uneProposition.codeEtudiant is not null) %}
                                <a href="{{ path('desaffecterEtudiant', {'id': uneProposition.codeproposition}) }}" class="btn btn-warning"><i class="fa fa-graduation-cap" aria-hidden="true"></i> Desaffecter</a>
                            {% else %}

                                {% if uneProposition.codeEtat.codeEtat != 2 %}
                                    <a href="{{ path('validProposition', {'id': uneProposition.codeproposition}) }}" class="btn btn-success"><i class="fa fa-check" aria-hidden="true"></i> Valider</a><br/>
                                {% else %}
                                    <a href="{{ path('affecterEtudiant', {'id': uneProposition.codeproposition}) }}" class="btn btn-default"><i class="fa fa-graduation-cap" aria-hidden="true"></i> Affecter</a><br/>
                                {% endif %}
                                {% if uneProposition.codeEtat.codeEtat != 5 %}
                                    <a href="{{ path('rejectProposition', {'id': uneProposition.codeproposition}) }}" class="btn btn-danger"><i class="fa fa-minus-circle" aria-hidden="true"></i> Refuser</a><br/>
                                {% endif %}
                                {% if uneProposition.codeEtat.codeEtat != 4 %}
                                    <a href="{{ path('archiveProposition', {'id': uneProposition.codeproposition}) }}" class="btn btn-info"><i class="fa fa-archive" aria-hidden="true"></i> Archiver</a><br/>
                                {% endif %}
                             {% endif %}
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}
{% block javascripts %}
    <script>
        $(document).ready( function () {
            $('#propositionsTable').DataTable({
                "language": {
                    "url": "{{ asset('js/datatables-french.json') }}"
                }
            });
        });
    </script>
{% endblock %}